<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plataforma UniPsi | Rede Profissional</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

<style>
  :root {
    --primary-color: #8B4513;
    --secondary-color: #DAA520;
    --bg-light: #FFF8F0;
    --text-dark: #333;
    --danger: #e74c3c;
    --success: #2ecc71;
    --warning: #f39c12;
    --info: #3498db;
    --super: #8B4513;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Roboto', sans-serif; background-color: var(--bg-light); color: var(--text-dark); line-height: 1.6; }

  /* Header */
  header { background: white; padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
  .logo-container { display: flex; align-items: center; gap: 15px; }
  .logo-svg { width: 45px; height: 45px; fill: var(--primary-color); }
  .brand-name { font-family: 'Montserrat', sans-serif; font-size: 1.4rem; font-weight: 700; color: var(--primary-color); }
  .brand-tagline { font-size: 0.8rem; color: #666; }

  /* Nav */
  .nav-tabs { display: flex; gap: 5px; margin-top: 1rem; flex-wrap: wrap; }
  .nav-btn { background: none; border: none; padding: 10px 15px; font-weight: 600; color: #666; cursor: pointer; border-bottom: 3px solid transparent; transition: 0.3s; font-size: 0.9rem; }
  .nav-btn.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
  .nav-btn:hover { color: var(--primary-color); }
  
  .auth-hidden { display: none !important; }

  /* Main */
  main { max-width: 1100px; margin: 30px auto; padding: 0 20px; min-height: 75vh; }
  .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); display: none; animation: fadeIn 0.4s ease-in-out; }
  .card.active-view { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* Inputs & Forms */
  .form-group { margin-bottom: 15px; }
  label { display: block; margin-bottom: 8px; font-weight: 500; }
  input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; font-family: inherit; }
  input:focus, textarea:focus { outline: none; border-color: var(--primary-color); }
  input[readonly] { background-color: #eee; cursor: not-allowed; }

  /* Mostrar Senha - Profissional com SVG - CORRIGIDO */
  .password-container { position: relative; }
  .password-container input { padding-right: 50px; }
  .toggle-password { 
    position: absolute; 
    right: 12px; 
    top: 50%; 
    transform: translateY(-50%); 
    background: none; 
    border: none; 
    cursor: pointer; 
    width: 24px; 
    height: 24px; 
    padding: 0; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    transition: 0.2s; 
    z-index: 10; 
  }
  .toggle-password:hover { opacity: 0.7; }
  .toggle-password svg { width: 20px; height: 20px; fill: var(--primary-color); }
  
  /* Corre√ß√£o espec√≠fica para campos com label */
  .form-group.password-container .toggle-password {
    top: calc(50% + 14px);
  }

  /* Checkbox Manter Conectado */
  .remember-me { display: flex; align-items: center; gap: 8px; margin-bottom: 15px; margin-top: 10px; }
  .remember-me input[type="checkbox"] { width: auto; cursor: pointer; }
  .remember-me label { margin: 0; font-size: 0.9rem; cursor: pointer; }

  /* Buttons */
  .btn { padding: 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; color: white; width: 100%; transition: 0.2s; text-align: center; text-decoration: none; display: inline-block; }
  .btn-primary { background-color: var(--primary-color); } .btn-primary:hover { background-color: #6B3410; }
  .btn-secondary { background-color: var(--secondary-color); color: #333; } .btn-secondary:hover { background-color: #B8860B; }
  .btn-danger { background-color: var(--danger); width: auto; padding: 8px 16px; }
  .btn-warning { background-color: var(--warning); color:white;}
  .btn-info { background-color: var(--info); color: white; }
  .btn-super { background-color: var(--primary-color); color: white; } 
  .btn-outline { background: transparent; border: 1px solid #ccc; color: #555; width: auto; padding: 8px 12px; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 5px;}
  .btn-outline:hover { background: #f0f0f0; }

  /* Badges e Status */
  .badge { padding: 5px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; display: inline-block; }
  .badge-pendente { background: #fff3cd; color: #856404; }
  .badge-aprovado { background: #d4edda; color: #155724; }
  .badge-rejeitado { background: #f8d7da; color: #721c24; }
  .badge-adm { background: #D2B48C; color: #8B4513; }
  .badge-super { background: #F0E68C; color: #8B4513; border: 1px solid #DAA520; }
  .badge-founder { background: linear-gradient(135deg, #FFD700, #FFA500); color: #8B4513; border: 2px solid #DAA520; font-weight: 800; box-shadow: 0 2px 8px rgba(255,215,0,0.4); }

  /* Rede Social - LinkedIn Style com Rea√ß√µes */
  .social-post { border-bottom: 1px solid #eee; padding: 20px 0; }
  .post-header { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
  .post-avatar { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 2px solid #eee; }
  .post-author { font-weight: 700; color: var(--primary-color); font-size: 1rem; }
  .post-role { font-size: 0.75rem; color: #666; display: block; }
  .post-content { margin-bottom: 15px; color: #333; white-space: pre-wrap; font-size: 0.95rem; }
  .post-media { margin-top: 10px; position: relative; display: inline-block; max-width: 100%; }
  .post-media img, .post-media video { max-width: 100%; border-radius: 8px; max-height: 400px; object-fit: contain; background: #000; display: block; }
  
  .post-actions { display: flex; gap: 20px; border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px; flex-wrap: wrap; }
  .action-btn { background: none; border: none; cursor: pointer; color: #666; font-size: 0.9rem; display: flex; align-items: center; gap: 6px; font-weight: 600; padding: 5px 10px; border-radius: 4px; transition: 0.2s; position: relative;}
  .action-btn:hover { background: #f0f2f5; color: var(--primary-color); }
  
  .reactions-menu { display: flex; gap: 8px; background: white; border: 1px solid #ddd; border-radius: 20px; padding: 8px 12px; position: absolute; bottom: 30px; left: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; }
  .reaction-emoji { cursor: pointer; font-size: 1.3rem; padding: 4px 6px; transition: 0.2s; border-radius: 4px; }
  .reaction-emoji:hover { transform: scale(1.2); background: #f0f0f0; }
   
  .comment-section { background: #f0f2f5; padding: 15px; border-radius: 8px; margin-top: 10px; display: none; }
  .comment-item { border-bottom: 1px solid #e0e0e0; padding: 8px 0; font-size: 0.9rem; }

  /* √Årea de Criar Post e Previews */
  .create-post-box { background:#fff; padding:20px; border-radius:10px; margin-bottom:30px; border:1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  .cp-header { display: flex; gap: 10px; margin-bottom: 15px; }
  .cp-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
  .cp-input { width: 100%; border: 1px solid #ddd; border-radius: 20px; padding: 10px 15px; resize: none; min-height: 50px; font-family: inherit; }
  
  .media-preview-container { position: relative; display: inline-block; margin-top: 10px; display: none; }
  .media-preview { max-width: 200px; max-height: 200px; border-radius: 8px; border: 1px solid #ccc; object-fit: cover; }
  .btn-remove-media { position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.8); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }

  .cp-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
  .loading-bar { display: none; width: 100%; height: 4px; background: #eee; margin-top: 10px; border-radius: 2px; overflow: hidden; }
  .loading-fill { height: 100%; background: var(--primary-color); width: 0%; animation: load 2s infinite; }
  @keyframes load { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }

  /* Modal de Edi√ß√£o */
  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; }
  .modal-content { background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
  
  /* Loja / Recursos */
  .store-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
  .product-card { border: 1px solid #eee; border-radius: 10px; overflow: hidden; background: white; transition: 0.3s; position: relative; }
  .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
  .product-img { width: 100%; height: 150px; object-fit: cover; background: #eee; }
  .product-body { padding: 15px; }
  .product-title { font-weight: 700; margin-bottom: 5px; color: var(--text-dark); }
  .product-price { color: var(--success); font-weight: 700; font-size: 1.1rem; margin-bottom: 10px; }
  .product-desc { font-size: 0.85rem; color: #666; margin-bottom: 15px; height: 40px; overflow: hidden; }

  /* PSI-POP Cinema */
  .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
  .video-card { border: 1px solid #ddd; border-radius: 10px; overflow: hidden; background: white; transition: 0.3s; cursor: pointer; }
  .video-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
  .video-thumbnail { width: 100%; height: 160px; background: #000; position: relative; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; }
  .video-info { padding: 15px; }
  .video-title { font-weight: 700; margin-bottom: 5px; color: var(--primary-color); }
  .video-duration { font-size: 0.8rem; color: #999; margin-bottom: 10px; }
  .video-actions { display: flex; gap: 10px; }
  .video-actions button { flex: 1; padding: 8px; font-size: 0.8rem; }

  /* Chat Privado - Profissional */
  .chat-container { display: flex; height: 600px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: white; }
  .chat-sidebar { width: 35%; border-right: 1px solid #ddd; display: flex; flex-direction: column; background: #f9f9f9; }
  .chat-search-box { padding: 15px; border-bottom: 1px solid #ddd; }
  .chat-search-box input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 20px; font-size: 0.9rem; }
  .chat-list { flex: 1; overflow-y: auto; }
  .chat-item { padding: 12px 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; display: flex; gap: 10px; align-items: center; }
  .chat-item:hover { background: #f0f0f0; }
  .chat-item.active { background: var(--secondary-color); }
  .chat-item-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
  .chat-item-info { flex: 1; min-width: 0; }
  .chat-item-name { font-weight: 600; font-size: 0.95rem; color: #333; }
  .chat-item-preview { font-size: 0.75rem; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .chat-messages { flex: 1; display: flex; flex-direction: column; }
  .chat-header { padding: 15px; background: var(--primary-color); color: white; font-weight: 600; display: flex; align-items: center; gap: 10px; }
  .chat-header-avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
  .chat-body { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
  .chat-message { padding: 10px 15px; border-radius: 8px; max-width: 70%; word-wrap: break-word; }
  .chat-message.own { align-self: flex-end; background: var(--secondary-color); color: #333; }
  .chat-message.other { align-self: flex-start; background: #e9ecef; color: #333; }
  .chat-message-time { font-size: 0.7rem; color: #999; margin-top: 3px; }
  .chat-input-area { padding: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; align-items: flex-end; }
  .chat-input-area input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; }
  .chat-input-area button { padding: 10px 15px; background: var(--primary-color); color: white; border: none; border-radius: 20px; cursor: pointer; }
  .chat-media-preview { max-width: 100px; max-height: 100px; border-radius: 6px; margin-bottom: 10px; }

  /* PAINEL DO GESTOR - NOVA INTERFACE FUNCIONAL */
  .admin-panel { background: white; border-radius: 12px; }
  .admin-header { background: linear-gradient(135deg, var(--primary-color), #6B3410); color: white; padding: 20px; border-radius: 12px 12px 0 0; }
  .admin-header h3 { margin-bottom: 5px; }
  .admin-header .badge { background: var(--secondary-color); color: #333; }
  
  .admin-tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 20px; }
  .admin-tab { padding: 12px 20px; background: none; border: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: 0.3s; }
  .admin-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
  .admin-tab:hover { color: var(--primary-color); }
  
  .admin-content { padding: 20px; }
  .admin-section { display: none; }
  .admin-section.active { display: block; }
  
  .member-card { background: #f9f9f9; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
  .member-card-info { flex: 1; min-width: 200px; }
  .member-card-name { font-weight: 700; color: var(--primary-color); font-size: 1.1rem; }
  .member-card-details { font-size: 0.85rem; color: #666; margin-top: 5px; }
  .member-card-badges { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }
  .member-card-actions { display: flex; gap: 8px; flex-wrap: wrap; }
  .member-card-actions button { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: 0.2s; }
  .btn-edit { background: var(--info); color: white; }
  .btn-edit:hover { background: #2980b9; }
  .btn-role { background: var(--primary-color); color: white; }
  .btn-role:hover { background: #6B3410; }
  .btn-reset { background: var(--warning); color: white; }
  .btn-reset:hover { background: #e67e22; }
  .btn-delete { background: var(--danger); color: white; }
  .btn-delete:hover { background: #c0392b; }

  /* Utilit√°rios */
  .alert { padding: 15px; border-radius: 6px; margin-bottom: 20px; display: none; text-align: center; }
  .alert-error { background: #f8d7da; color: #721c24; }
  .hidden { display: none !important; }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
  th { background-color: #f8f9fa; color: var(--primary-color); }
  .table-container { overflow-x: auto; margin-top: 10px; margin-bottom: 30px;}

  

  /* Jitsi Meet Container */
  .jitsi-container { width: 100%; height: 600px; border-radius: 8px; overflow: hidden; }

  /* Responsividade Mobile */
  @media (max-width: 768px) {
    header { padding: 1rem; }
    .nav-tabs { flex-direction: column; gap: 0; margin-top: 0.5rem; }
    .nav-btn { padding: 8px 10px; font-size: 0.8rem; border-bottom: none; border-right: 3px solid transparent; }
    .nav-btn.active { border-right-color: var(--primary-color); border-bottom: none; }
    main { padding: 0 10px; margin: 15px auto; }
    .card { padding: 15px; }
    .chat-container { height: 400px; }
    .chat-sidebar { width: 40%; }
    .chat-message { max-width: 85%; }
    .store-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    .video-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
    .post-media img, .post-media video { max-height: 250px; }
    .member-card { flex-direction: column; align-items: flex-start; }
    .member-card-actions { width: 100%; }
    .member-card-actions button { flex: 1; }
  }
  
  @media (max-width: 480px) {
    header { flex-direction: column; gap: 10px; padding: 0.8rem; }
    .brand-name { font-size: 1.1rem; }
    .nav-tabs { width: 100%; flex-direction: row; gap: 0; }
    .nav-btn { flex: 1; padding: 6px 5px; font-size: 0.65rem; border-right: none; border-bottom: 3px solid transparent; }
    .nav-btn.active { border-bottom-color: var(--primary-color); }
    main { padding: 0 5px; margin: 10px auto; }
    .card { padding: 10px; }
    .store-grid { grid-template-columns: 1fr; }
    .video-grid { grid-template-columns: 1fr; }
    .chat-container { height: 300px; flex-direction: column; }
    .chat-sidebar { width: 100%; height: 80px; border-right: none; border-bottom: 1px solid #ddd; display: flex; }
    .chat-search-box { display: none; }
    .chat-list { flex-direction: row; overflow-x: auto; }
    .chat-item { min-width: 80px; flex-direction: column; padding: 8px; }
    .chat-item-avatar { width: 32px; height: 32px; }
    .chat-item-name { font-size: 0.75rem; }
    .chat-item-preview { display: none; }
    .chat-messages { display: none; }
    .chat-messages.active { display: flex; }
    .admin-tabs { flex-wrap: wrap; }
    .admin-tab { flex: 1; padding: 10px; font-size: 0.8rem; }
    .member-card-actions button { padding: 6px 10px; font-size: 0.75rem; }
  }
  
  @media (min-width: 1920px) {
    main { max-width: 1400px; }
    .store-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
    .video-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
  }

  footer { text-align: center; padding: 25px; font-size: 0.85rem; color: #888; border-top: 1px solid #eee; margin-top: 40px; }
</style>
</head>
<body oncontextmenu="return false;">

<header>
  <div class="logo-container">
    <svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 2c1.66 0 3 1.34 3 3v3h2V7c0-2.76-2.24-5-5-5S7 4.24 7 7v3h2V7c0-1.66 1.34-3 3-3zm3 11v2h-2v-2h-2v2H9v-2H7v4h10v-4h-2z"/>
    </svg>
    <div>
        <div class="brand-name">Plataforma UniPsi</div>
        <div class="brand-tagline">Rede Profissional de Psic√≥logos</div>
    </div>
  </div>
  <nav class="nav-tabs auth-hidden" id="mainNav">
    <button class="nav-btn active" id="btn-social">Feed Profissional</button>
    <button class="nav-btn" id="btn-perfil">Meu Perfil</button>
    <button class="nav-btn" id="btn-chat">Chat Privado</button>
    <button class="nav-btn" id="btn-recursos">Recursos & Loja</button>
    <button class="nav-btn" id="btn-psipop">PSI-POP</button>
    <button class="nav-btn" id="btn-reunioes">Reuni√µes</button>
    <button class="nav-btn" id="btn-staff">Junte-se √† Equipe</button>
    <button class="nav-btn" id="btn-admin">Painel do Gestor</button>
    <button class="nav-btn" id="btn-sair" style="color:var(--danger)">Sair</button>
  </nav>
</header>

<main>
  <section id="loginView" class="card active-view" style="max-width: 500px; margin: 50px auto;">
    <h2 style="text-align: center; color: var(--primary-color);">Bem-vindo(a), Psi!</h2>
    <p style="text-align: center; color: #666; margin-bottom: 25px;">Fa√ßa login com seu CRP para acessar a rede.</p>
    
    <div id="loginAlert" class="alert alert-error"></div>

    <form id="loginForm">
        <div class="form-group">
            <label>CRP (Ex: 00/00000)</label>
            <input type="text" id="loginCrp" placeholder="Digite seu CRP" required class="mask-crp">
        </div>
        <div class="form-group password-container">
            <label>Senha</label>
            <input type="password" id="loginSenha" placeholder="Sua senha segura" required>
            <button type="button" class="toggle-password" id="toggleLoginPassword">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
        </div>
        <div class="remember-me">
            <input type="checkbox" id="rememberMe">
            <label for="rememberMe">Manter-me conectado</label>
        </div>
        <button type="submit" class="btn btn-primary" style="margin-bottom: 15px;">Entrar na Rede</button>
        <div style="text-align: center;">
            <a href="#" id="linkCadastro" style="color: var(--secondary-color); font-weight: bold; text-decoration: none;">N√£o tem conta? Cadastre-se aqui.</a>
        </div>
    </form>
  </section>

  <section id="inscricaoView" class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Nova Inscri√ß√£o Profissional</h2>
        <button id="btnVoltarLogin" class="btn btn-secondary" style="width: auto;">Voltar ao Login</button>
    </div>
    <p style="margin-bottom: 20px; font-size: 0.9rem; color: #666;">Seus dados ser√£o analisados. O prefixo "Psi." ser√° adicionado automaticamente.</p>
    
    <form id="inscriptionForm">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group"><label>Nome Completo</label><input type="text" id="nome" required placeholder="Ex: Macs Wellison"></div>
          <div class="form-group"><label>E-mail</label><input type="email" id="email" required placeholder="email@exemplo.com"></div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group"><label>WhatsApp</label><input type="text" id="whatsapp" required placeholder="(XX) XXXXX-XXXX" class="mask-tel"></div>
          <div class="form-group"><label>CRP (Usu√°rio)</label><input type="text" id="crp" required placeholder="XX/XXXXX" class="mask-crp"></div>
      </div>
      <div class="form-group password-container">
        <label>Senha de Acesso</label>
        <input type="password" id="senhaCadastro" required placeholder="Crie uma senha para entrar">
        <button type="button" class="toggle-password" id="toggleCadastroPassword">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
          </svg>
        </button>
      </div>
      
      <div class="form-group"><label>Abordagem Cl√≠nica</label><input type="text" id="abordagem" placeholder="Ex: TCC, Psican√°lise..."></div>
      <div class="form-group"><label>Especialidades</label><textarea id="especialidades" rows="2" placeholder="Separe por v√≠rgula..."></textarea></div>
      <div class="form-group"><label>Foto de Perfil</label><input type="file" id="fotoFile" accept="image/*"></div>
      <button type="submit" class="btn btn-primary">Criar Conta Profissional</button>
    </form>
  </section>

  <section id="profileView" class="card">
    <h2>Meu Perfil Profissional</h2>
    <p style="color:#666; margin-bottom:20px;">Atualize suas informa√ß√µes vis√≠veis na rede.</p>
    <form id="profileForm">
        <div style="text-align: center; margin-bottom: 20px;">
            <img id="profilePreview" src="" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #eee;">
        </div>
        <div class="form-group"><label>Alterar Foto</label><input type="file" id="profileFotoFile" accept="image/*"></div>
        <div class="form-group"><label>Nome (Inalter√°vel)</label><input type="text" id="profileNome" readonly></div>
        <div class="form-group"><label>CRP (Inalter√°vel)</label><input type="text" id="profileCrp" readonly></div>
        <div class="form-group"><label>Abordagem Cl√≠nica</label><input type="text" id="profileAbordagem"></div>
        <div class="form-group"><label>Especialidades</label><textarea id="profileEspecialidades" rows="2"></textarea></div>
        
        <div class="form-group password-container">
            <label>Nova Senha (Deixe em branco para manter a atual)</label>
            <input type="password" id="profileSenha" placeholder="Digite apenas se quiser alterar sua senha">
            <button type="button" class="toggle-password" id="toggleProfilePassword">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
        </div>

        <button type="submit" class="btn btn-secondary">Salvar Altera√ß√µes</button>
    </form>
    
    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
        <h4 style="color: var(--danger); margin-bottom: 15px;">Zona de Perigo</h4>
        <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Ao excluir sua conta, voc√™ perder√° acesso permanente √† plataforma e todos os seus dados ser√£o removidos.</p>
        <button id="btnExcluirMinhaConta" class="btn btn-danger" style="width: auto; padding: 12px 25px;">üóëÔ∏è Excluir Minha Conta</button>
    </div>
  </section>

  <section id="socialView" class="card">
    <h2>Comunidade Profissional</h2>
    <p style="color:#666; margin-bottom:20px;">Interaja, compartilhe e conecte-se com colegas.</p>

    <div class="create-post-box">
        <div class="cp-header">
            <img id="userAvatarPost" src="https://via.placeholder.com/40" class="cp-avatar">
            <div style="width: 100%;">
                <textarea id="textoPost" class="cp-input" placeholder="Come√ßar publica√ß√£o... (M√≠dia, Artigo, D√∫vida)"></textarea>
                
                <div id="mediaPreviewContainer" class="media-preview-container">
                    <button type="button" class="btn-remove-media" id="btnRemoveMedia">X</button>
                    <img id="previewMedia" class="media-preview">
                </div>

                <div id="postLoading" class="loading-bar"><div class="loading-fill"></div></div>
            </div>
        </div>
        <div class="cp-actions">
            <div style="display: flex; gap: 10px;">
                <input type="file" id="midiaFile" accept="image/*,video/*" style="display: none;">
                <button type="button" class="btn-outline" onclick="document.getElementById('midiaFile').click()">
                    üì∑ Foto / üé• V√≠deo
                </button>
            </div>
            <button id="btnPublicar" class="btn btn-primary" style="width:auto; padding: 8px 25px;">Publicar</button>
        </div>
    </div>

    <h3 style="border-bottom:2px solid #eee; padding-bottom:10px; margin-bottom:20px;">Feed de Atualiza√ß√µes</h3>
    <div id="feedContainer">
      <p style="text-align:center; color:#999;">Carregando feed profissional...</p>
    </div>

    <h3 style="border-bottom:2px solid #eee; padding-bottom:10px; margin:40px 0 20px;">Membros da Rede</h3>
    <input type="text" id="buscaMembro" placeholder="üîç Buscar profissional..." style="margin-bottom:20px;">
    <div class="store-grid" id="containerMembros"></div>
  </section>

  <section id="chatView" class="card">
    <h2>Chat Privado Profissional</h2>
    <p style="color:#666; margin-bottom:20px;">Converse com colegas de forma segura e criptografada.</p>
    <div class="chat-container">
      <div class="chat-sidebar">
        <div class="chat-search-box">
          <input type="text" id="chatSearch" placeholder="Buscar contato...">
        </div>
        <div class="chat-list" id="chatList"></div>
      </div>
      <div class="chat-messages" id="chatMessagesArea" style="display:none;">
        <div class="chat-header" id="chatHeaderName">
          <img id="chatHeaderAvatar" class="chat-header-avatar" src="">
          <span id="chatHeaderNameText">Selecione um contato</span>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input-area">
          <input type="file" id="chatMediaFile" accept="image/*,video/*,audio/*" style="display:none;">
          <button type="button" class="btn-outline" onclick="document.getElementById('chatMediaFile').click()" style="width:auto;">üìé</button>
          <input type="text" id="chatInput" placeholder="Digite uma mensagem...">
          <button id="btnSendChat" class="btn btn-primary" style="width:auto; padding:8px 20px;">Enviar</button>
        </div>
      </div>
    </div>
  </section>

  <section id="recursosView" class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Recursos & Loja UniPsi</h2>
        <button id="btnNovoProduto" class="btn btn-super hidden" style="width:auto;">+ Adicionar Produto</button>
    </div>
    <div id="formProduto" class="hidden" style="background:#f3e5f5; padding:20px; margin-bottom:20px; border-radius:8px;">
        <h4>Cadastrar Novo Produto</h4>
        <div class="form-group"><label>T√≠tulo</label><input type="text" id="prodTitulo"></div>
        <div class="form-group"><label>Descri√ß√£o Curta</label><input type="text" id="prodDesc"></div>
        <div class="form-group"><label>Valor (R$)</label><input type="text" id="prodValor" placeholder="Ex: 29,90 ou Gr√°tis"></div>
        <div class="form-group"><label>Link de Compra/Download</label><input type="text" id="prodLink"></div>
        <div class="form-group"><label>URL da Imagem</label><input type="text" id="prodImg" placeholder="https://..."></div>
        <button id="btnSalvarProduto" class="btn btn-super">Publicar Produto</button>
    </div>
    <div class="store-grid" id="lojaContainer"><p>Carregando produtos...</p></div>
  </section>

  <section id="psiPopView" class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>üé¨ PSI-POP - Cinema para Psic√≥logos</h2>
        <button id="btnNovoVideo" class="btn btn-super hidden" style="width:auto;">+ Upload de V√≠deo</button>
    </div>
    <div id="formVideo" class="hidden" style="background:#f3e5f5; padding:20px; margin-bottom:20px; border-radius:8px;">
        <h4>Upload de V√≠deo em Alta Resolu√ß√£o</h4>
        <div class="form-group"><label>T√≠tulo do V√≠deo</label><input type="text" id="videoTitulo"></div>
        <div class="form-group"><label>Descri√ß√£o</label><textarea id="videoDesc" rows="2"></textarea></div>
        <div class="form-group"><label>Dura√ß√£o (minutos)</label><input type="number" id="videoDuracao"></div>
        <div class="form-group"><label>URL do V√≠deo (MP4 HD)</label><input type="text" id="videoUrl" placeholder="https://..."></div>
        <div class="form-group"><label>Thumbnail (Imagem)</label><input type="text" id="videoThumbnail" placeholder="https://..."></div>
        <button id="btnSalvarVideo" class="btn btn-super">Publicar V√≠deo</button>
    </div>
    <div class="video-grid" id="videoContainer"><p>Carregando v√≠deos...</p></div>
  </section>

  <section id="reunioesView" class="card">
    <h2>Reuni√µes Profissionais</h2>
    <p style="color:#666; margin-bottom:20px;">Conecte-se com colegas atrav√©s de videochamadas.</p>
    <div class="form-group">
        <label>ID da Sala de Reuni√£o</label>
        <input type="text" id="jitsiRoomId" placeholder="Ex: unipsi-reuniao-001" value="unipsi-reuniao-001">
    </div>
    <button id="btnEntrarReuniao" class="btn btn-primary" style="margin-bottom:20px;">Entrar na Reuni√£o</button>
    <div id="jitsiContainer" class="jitsi-container"></div>
  </section>

  <section id="staffRequestView" class="card">
    <h2>Candidatura para Administra√ß√£o</h2>
    <form id="staffForm">
        <div class="form-group"><label>Nome</label><input type="text" id="staffNome" required></div>
        <div class="form-group"><label>WhatsApp</label><input type="text" id="staffWhats" required class="mask-tel"></div>
        <div class="form-group"><label>Motivo</label><textarea id="staffMotivo" required></textarea></div>
        <button type="submit" class="btn btn-warning">Enviar Candidatura</button>
    </form>
  </section>

  <!-- PAINEL DO GESTOR - NOVA INTERFACE -->
  <section id="adminView" class="card">
    <div id="adminAuthContainer" style="max-width:400px; margin:50px auto;">
      <h3 style="text-align:center; margin-bottom:20px; color: var(--primary-color);">Acesso ao Painel do Gestor</h3>
      <p style="text-align:center; color:#666; margin-bottom:20px;">Digite a senha para acessar as configura√ß√µes de gestor.</p>
      <div class="form-group password-container">
        <label>Senha do Gestor</label>
        <input type="password" id="adminPassword" placeholder="Digite a senha" style="font-size:1rem;">
        <button type="button" class="toggle-password" id="toggleAdminPassword">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
          </svg>
        </button>
      </div>
      <div class="remember-me">
        <input type="checkbox" id="rememberAdmin">
        <label for="rememberAdmin">Manter-me conectado ao painel</label>
      </div>
      <button id="btnAcessarAdmin" class="btn btn-primary">Acessar Painel</button>
      <div id="adminAuthError" class="alert alert-error"></div>
      <p style="text-align:center; color:#999; font-size:0.8rem; margin-top:15px;">Senhas: Admin, Supervisor ou Fundador</p>
    </div>

    <div id="adminDashboard" style="display:none;">
      <div class="admin-panel">
        <div class="admin-header">
          <h3>Painel do Gestor</h3>
          <span id="nivelAcesso" class="badge">Acesso Restrito</span>
        </div>
        
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="membros">üë§ Membros</button>
          <button class="admin-tab" data-tab="pendentes">‚è≥ Pendentes</button>
          <button class="admin-tab" data-tab="staff">üõ°Ô∏è Staff</button>
        </div>
        
        <div class="admin-content">
          <!-- Aba Membros Aprovados -->
          <div id="tab-membros" class="admin-section active">
            <h4 style="margin-bottom:15px; color:var(--primary-color);">Membros Aprovados</h4>
            <div id="membrosAprovados"></div>
          </div>
          
          <!-- Aba Pendentes -->
          <div id="tab-pendentes" class="admin-section">
            <h4 style="margin-bottom:15px; color:var(--warning);">Aguardando Aprova√ß√£o</h4>
            <div id="membrosPendentes"></div>
          </div>
          
          <!-- Aba Staff -->
          <div id="tab-staff" class="admin-section">
            <h4 style="margin-bottom:15px; color:var(--info);">Candidatos √† Staff</h4>
            <div id="candidatosStaff"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>



<!-- Modais -->
<div id="editPostModal" class="modal-overlay">
    <div class="modal-content">
        <h3>Editar Publica√ß√£o</h3>
        <input type="hidden" id="editPostId">
        <div class="form-group">
            <label>Texto</label>
            <textarea id="editPostText" rows="4"></textarea>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
             <button id="btnCancelEdit" class="btn btn-outline" style="width:auto;">Cancelar</button>
             <button id="btnSaveEdit" class="btn btn-primary" style="width:auto;">Salvar</button>
        </div>
    </div>
</div>

<!-- Modal para Mudar Cargo -->
<div id="changeRoleModal" class="modal-overlay">
    <div class="modal-content">
        <h3 style="color:var(--primary-color);">Mudar Cargo</h3>
        <input type="hidden" id="changeRoleMemberId">
        <div class="form-group">
            <label>Membro</label>
            <input type="text" id="changeRoleMemberName" readonly>
        </div>
        <div class="form-group">
            <label>Novo Cargo</label>
            <select id="changeRoleSelect">
              <option value="">-- Selecione --</option>
              <option value="Membro">Membro</option>
              <option value="Admin">Admin</option>
              <option value="Supervisor">Supervisor</option>
              <option value="Fundador">Fundador</option>
            </select>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
             <button id="btnCancelChangeRole" class="btn btn-outline" style="width:auto;">Cancelar</button>
             <button id="btnConfirmChangeRole" class="btn btn-primary" style="width:auto;">Confirmar</button>
        </div>
    </div>
</div>

<!-- Modal para Reset de Senha -->
<div id="resetPasswordModal" class="modal-overlay">
    <div class="modal-content">
        <h3 style="color:var(--warning);">Reset de Senha</h3>
        <input type="hidden" id="resetPasswordMemberId">
        <div class="form-group">
            <label>Membro</label>
            <input type="text" id="resetPasswordMemberName" readonly>
        </div>
        <div class="form-group password-container">
            <label>Nova Senha</label>
            <input type="password" id="resetPasswordNew" placeholder="Digite a nova senha">
            <button type="button" class="toggle-password" id="toggleResetPassword">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
            </button>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
             <button id="btnCancelResetPassword" class="btn btn-outline" style="width:auto;">Cancelar</button>
             <button id="btnConfirmResetPassword" class="btn btn-primary" style="width:auto;">Confirmar</button>
        </div>
    </div>
</div>

<!-- Modal para Editar Membro -->
<div id="editMemberModal" class="modal-overlay">
    <div class="modal-content">
        <h3 style="color:var(--info);">Editar Membro</h3>
        <input type="hidden" id="editMemberId">
        <div class="form-group">
            <label>Nome</label>
            <input type="text" id="editMemberName" readonly>
        </div>
        <div class="form-group">
            <label>E-mail</label>
            <input type="email" id="editMemberEmail">
        </div>
        <div class="form-group">
            <label>WhatsApp</label>
            <input type="text" id="editMemberWhatsapp" class="mask-tel">
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
             <button id="btnCancelEditMember" class="btn btn-outline" style="width:auto;">Cancelar</button>
             <button id="btnConfirmEditMember" class="btn btn-primary" style="width:auto;">Salvar</button>
        </div>
    </div>
</div>

<footer>&copy; 2025 Plataforma UniPsi. Desenvolvido por Macs Wellison.</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, remove, update, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDSDDP98aln1BkuBzDaX7txziAp5CPEpD0",
    authDomain: "unipsi-792b6.firebaseapp.com",
    projectId: "unipsi-792b6",
    storageBucket: "unipsi-792b6.firebasestorage.app",
    messagingSenderId: "44741764168",
    appId: "1:44741764168:web:15ff9121ce50333dbd247d",
    measurementId: "G-HFSTGMGCQ3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const CONFIG = { linkGrupo: "https://chat.whatsapp.com/K77s3h51A7J6xvJW1TMxmk" };
  // Upload ilimitado - sem limite de tamanho
  
  // SENHAS DO PAINEL DO GESTOR
  const ADMIN_PASSWORDS = {
    'unipsi_adm': 'Admin',
    'unipsi_super': 'Supervisor',
    'unipsi_founder': 'Fundador'
  };

  let userSession = null;
  let adminAuthenticated = false;
  let adminLevel = null;
  let currentChatUser = null;
  let fotoBase64 = "";
  let midiaPostBase64 = "";
  let midiaPostType = "";
  let profileFotoBase64 = "";
  let chatMediaBase64 = "";
  let chatMediaType = "";
  let allMembers = [];

  const $ = (id) => document.getElementById(id);

  // Fun√ß√£o simples de criptografia
  const encryptMessage = (msg) => btoa(msg);
  const decryptMessage = (msg) => atob(msg);

  // --- MOSTRAR/ESCONDER SENHA - SVG Profissional ---
  const setupPasswordToggle = (toggleBtnId, inputId) => {
      const btn = $(toggleBtnId);
      if(!btn) return;
      btn.onclick = (e) => {
          e.preventDefault();
          const input = $(inputId);
          const svg = btn.querySelector('svg');
          if(input.type === 'password') {
              input.type = 'text';
              svg.innerHTML = '<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
          } else {
              input.type = 'password';
              svg.innerHTML = '<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
          }
      };
  };

  setupPasswordToggle('toggleLoginPassword', 'loginSenha');
  setupPasswordToggle('toggleCadastroPassword', 'senhaCadastro');
  setupPasswordToggle('toggleProfilePassword', 'profileSenha');
  setupPasswordToggle('toggleAdminPassword', 'adminPassword');
  setupPasswordToggle('toggleResetPassword', 'resetPasswordNew');

  // --- M√ÅSCARAS ---
  const mascaraTelefone = (v) => {
    v = v.replace(/\D/g,"");
    v = v.replace(/^(\d{2})(\d)/g,"($1) $2");
    v = v.replace(/(\d)(\d{4})$/,"$1-$2");
    return v.substring(0, 15);
  };

  const mascaraCRP = (v) => {
    v = v.replace(/\D/g,"");
    v = v.replace(/^(\d{2})(\d)/, "$1/$2");
    return v.substring(0, 8);
  };

  document.querySelectorAll('.mask-tel').forEach(i => i.oninput = (e) => e.target.value = mascaraTelefone(e.target.value));
  document.querySelectorAll('.mask-crp').forEach(i => i.oninput = (e) => e.target.value = mascaraCRP(e.target.value));

  // --- ARQUIVOS ---
  $('fotoFile').addEventListener('change', (e) => processFile(e.target.files[0], (res) => fotoBase64 = res));
  $('profileFotoFile').addEventListener('change', (e) => processFile(e.target.files[0], (res) => profileFotoBase64 = res));
  
  $('midiaFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if(file) {
          
          const reader = new FileReader();
          reader.onload = function() { 
              midiaPostBase64 = reader.result; 
              midiaPostType = file.type.startsWith('video') ? 'video' : 'image';
              $('previewMedia').src = midiaPostBase64;
              $('mediaPreviewContainer').style.display = 'inline-block';
          };
          reader.readAsDataURL(file);
      }
  });

  $('chatMediaFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if(file) {
          
          const reader = new FileReader();
          reader.onload = function() { 
              chatMediaBase64 = reader.result; 
              chatMediaType = file.type.startsWith('video') ? 'video' : (file.type.startsWith('audio') ? 'audio' : 'image');
              alert("Arquivo selecionado: " + file.name);
          };
          reader.readAsDataURL(file);
      }
  });

  $('btnRemoveMedia').onclick = () => {
      midiaPostBase64 = ""; midiaPostType = ""; $('midiaFile').value = ""; $('mediaPreviewContainer').style.display = 'none';
  };

  function processFile(file, callback) {
      if(!file) return;
      
      const reader = new FileReader();
      reader.onload = () => callback(reader.result);
      reader.readAsDataURL(file);
  }

  // --- NAVEGA√á√ÉO ---
  const showView = (viewId) => {
      document.querySelectorAll('.card').forEach(c => c.classList.remove('active-view'));
      $(viewId).classList.add('active-view');
  };

  const setActiveNav = (btnId) => {
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      $(btnId).classList.add('active');
  };

  // --- LOGIN COM MANTER CONECTADO ---
  $('loginForm').onsubmit = (e) => {
      e.preventDefault();
      const crp = $('loginCrp').value;
      const senha = $('loginSenha').value;
      const rememberMe = $('rememberMe').checked;
      
      get(query(ref(db, 'membros'), orderByChild('crp'), equalTo(crp))).then(snapshot => {
          if(snapshot.exists()) {
              const dados = Object.entries(snapshot.val())[0];
              const [id, user] = dados;
              if(user.senha === senha) {
                  userSession = { ...user, id };
                  localStorage.setItem('userSession', JSON.stringify(userSession));
                  if(rememberMe) localStorage.setItem('rememberLogin', 'true');
                  adminAuthenticated = false;
                  document.getElementById('mainNav').classList.remove('auth-hidden');
                  showView('socialView');
                  setActiveNav('btn-social');
                  populateProfile();
                  $('userAvatarPost').src = userSession.foto || 'https://via.placeholder.com/40';
                  
                  if(userSession.cargo === 'Admin' || userSession.cargo === 'Supervisor' || userSession.cargo === 'Fundador') {
                      $('btn-admin').style.display = 'block';
                  } else {
                      $('btn-admin').style.display = 'none';
                  }
              } else {
                  $('loginAlert').textContent = "Senha incorreta!";
                  $('loginAlert').style.display = 'block';
              }
          } else {
              $('loginAlert').textContent = "CRP n√£o encontrado!";
              $('loginAlert').style.display = 'block';
          }
      });
  };

  $('linkCadastro').onclick = (e) => {
      e.preventDefault();
      showView('inscricaoView');
  };

  $('btnVoltarLogin').onclick = () => {
      showView('loginView');
  };

  // --- INSCRI√á√ÉO ---
  $('inscriptionForm').onsubmit = (e) => {
      e.preventDefault();
      const nome = "Psi. " + $('nome').value;
      const dados = {
          nome: nome,
          email: $('email').value,
          whatsapp: $('whatsapp').value,
          crp: $('crp').value,
          senha: $('senhaCadastro').value,
          abordagem: $('abordagem').value,
          especialidades: $('especialidades').value.split(','),
          foto: fotoBase64,
          cargo: 'Membro',
          status: 'Pendente'
      };
      push(ref(db, 'membros'), dados).then(() => {
          alert("Inscri√ß√£o enviada! Aguarde aprova√ß√£o.");
          showView('loginView');
      });
  };

  // --- PERFIL ---
  function populateProfile() {
      if(!userSession) return;
      $('profileNome').value = userSession.nome;
      $('profileCrp').value = userSession.crp;
      $('profileAbordagem').value = userSession.abordagem || "";
      $('profileEspecialidades').value = userSession.especialidades ? userSession.especialidades.join(',') : "";
      $('profilePreview').src = userSession.foto || 'https://via.placeholder.com/100';
      $('profileSenha').value = "";
  }

  $('profileForm').onsubmit = (e) => {
      e.preventDefault();
      const updates = {
          abordagem: $('profileAbordagem').value,
          especialidades: $('profileEspecialidades').value.split(','),
      };
      
      const novaSenha = $('profileSenha').value.trim();
      if(novaSenha) {
          updates.senha = novaSenha;
      }

      if(profileFotoBase64) updates.foto = profileFotoBase64;

      update(ref(db, `membros/${userSession.id}`), updates).then(() => {
          alert("Perfil atualizado!");
          userSession = { ...userSession, ...updates };
          $('profileSenha').value = "";
      });
  };

  // --- SOCIAL FEED COM REA√á√ïES ---
  $('btnPublicar').onclick = () => {
      if(!userSession) return alert("Sess√£o expirada.");
      const texto = $('textoPost').value;
      if(!texto && !midiaPostBase64) return alert("Escreva algo.");
      
      $('postLoading').style.display = 'block';
      $('btnPublicar').disabled = true;

      push(ref(db, 'posts'), {
          autor: userSession.nome,
          autorId: userSession.id,
          cargo: userSession.cargo,
          fotoAutor: userSession.foto,
          texto: texto,
          midia: midiaPostBase64,
          midiaTipo: midiaPostType,
          data: new Date().toLocaleString('pt-BR'),
          reactions: {}
      }).then(() => {
          $('textoPost').value = "";
          $('midiaFile').value = "";
          midiaPostBase64 = "";
          $('mediaPreviewContainer').style.display = 'none';
          $('postLoading').style.display = 'none';
          $('btnPublicar').disabled = false;
      }).catch(err => {
          alert("Erro no upload. Tente uma imagem menor.");
          $('postLoading').style.display = 'none';
          $('btnPublicar').disabled = false;
      });
  };

  onValue(ref(db, 'posts'), (snapshot) => {
      const feed = $('feedContainer');
      feed.innerHTML = "";
      const posts = Object.entries(snapshot.val() || {}).map(([k, v]) => ({...v, id: k})).reverse();
      
      if(posts.length === 0) feed.innerHTML = "<p style='text-align:center; padding:20px;'>Nenhum post.</p>";

      posts.forEach(post => {
          const isMe = userSession && userSession.id === post.autorId;
          const isSuper = userSession && (userSession.cargo === 'Supervisor' || userSession.cargo === 'Fundador');
          
          let actionButtons = "";
          if (isMe) {
             actionButtons += `<button class="action-btn btn-edit-post" data-id="${post.id}" data-txt="${encodeURIComponent(post.texto)}" style="margin-left:auto;">‚úèÔ∏è Editar</button>`;
          }
          if (isMe || isSuper) {
             const style = !isMe ? "margin-left:auto; color:red" : "color:red";
             actionButtons += `<button class="action-btn btn-del-post" data-id="${post.id}" style="${style}">üóëÔ∏è</button>`;
          }

          let midiaHtml = "";
          if(post.midia) {
              if(post.midiaTipo === 'video') midiaHtml = `<div class="post-media"><video src="${post.midia}" controls></video></div>`;
              else midiaHtml = `<div class="post-media"><img src="${post.midia}"></div>`;
          }

          const reactions = post.reactions || {};
          const reactionCounts = {};
          let userReactionEmoji = '';
          
          Object.entries(reactions).forEach(([oderId, reaction]) => {
              if(!reactionCounts[reaction]) reactionCounts[reaction] = 0;
              reactionCounts[reaction]++;
              if(userSession && oderId === userSession.id) userReactionEmoji = reaction;
          });

          const reactionDisplay = Object.entries(reactionCounts).map(([r, count]) => `${r} ${count}`).join(' ');
          const totalReactions = Object.keys(reactions).length;

          feed.innerHTML += `
          <div class="social-post">
              <div class="post-header">
                  <img src="${post.fotoAutor || 'https://via.placeholder.com/40'}" class="post-avatar">
                  <div>
                      <span class="post-author">${post.autor}</span>
                      <span class="post-role">${post.cargo}</span>
                      <div style="font-size:0.75rem; color:#999">${post.data}</div>
                  </div>
              </div>
              <div class="post-content">${post.texto}</div>
              ${midiaHtml}
              <div class="post-actions">
                  <button class="action-btn btn-like" data-id="${post.id}" style="position:relative;">
                    ${userReactionEmoji || 'üëç'} ${totalReactions}
                    <div class="reactions-menu" style="display:none;">
                      <span class="reaction-emoji" data-reaction="üëç">üëç</span>
                      <span class="reaction-emoji" data-reaction="‚ù§Ô∏è">‚ù§Ô∏è</span>
                      <span class="reaction-emoji" data-reaction="üòÇ">üòÇ</span>
                      <span class="reaction-emoji" data-reaction="üòÆ">üòÆ</span>
                      <span class="reaction-emoji" data-reaction="üò¢">üò¢</span>
                      <span class="reaction-emoji" data-reaction="üò†">üò†</span>
                    </div>
                  </button>
                  <button class="action-btn" onclick="document.getElementById('comment-box-${post.id}').style.display='block'">üí¨ Comentar</button>
                  ${actionButtons}
              </div>
              ${reactionDisplay ? `<div style="font-size:0.85rem; color:#666; margin-top:8px; padding-top:8px; border-top:1px solid #eee;">${reactionDisplay}</div>` : ''}
              <div id="comment-box-${post.id}" class="comment-section">
                   <div style="margin-bottom:10px; max-height:100px; overflow-y:auto;">
                      ${post.comentarios ? Object.values(post.comentarios).map(c => `<div class="comment-item"><strong>${c.autor}:</strong> ${c.texto}</div>`).join('') : ''}
                   </div>
                   <div style="display:flex; gap:5px;">
                      <input type="text" id="input-c-${post.id}" placeholder="Comentar..." style="width:100%; border:1px solid #ddd; padding:8px; border-radius:20px;">
                      <button class="btn-primary btn-send-comment" data-id="${post.id}" style="width:auto; padding:5px 15px; border-radius:20px;">Enviar</button>
                   </div>
              </div>
          </div>`;
      });

      attachPostEvents();
  });

  function attachPostEvents() {
      document.querySelectorAll('.btn-like').forEach(b => {
          b.onmouseenter = () => {
              const menu = b.querySelector('.reactions-menu');
              if(menu) menu.style.display = 'flex';
          };
          b.onmouseleave = () => {
              const menu = b.querySelector('.reactions-menu');
              if(menu) menu.style.display = 'none';
          };
          
          b.querySelectorAll('.reaction-emoji').forEach(emoji => {
              emoji.onclick = (e) => {
                  e.stopPropagation();
                  if(!userSession) return;
                  const postId = b.dataset.id;
                  const reaction = emoji.dataset.reaction;
                  
                  update(ref(db, `posts/${postId}/reactions`), { [userSession.id]: reaction });
              };
          });
      });
      
      document.querySelectorAll('.btn-del-post').forEach(b => {
          b.onclick = () => { if(confirm("Apagar post?")) remove(ref(db, 'posts/' + b.dataset.id)); }
      });
      
      document.querySelectorAll('.btn-send-comment').forEach(b => {
          b.onclick = () => {
              const txt = $(`input-c-${b.dataset.id}`).value;
              if(txt && userSession) push(ref(db, `posts/${b.dataset.id}/comentarios`), { autor: userSession.nome, texto: txt });
          }
      });
      
      document.querySelectorAll('.btn-edit-post').forEach(b => {
          b.onclick = () => {
              const id = b.dataset.id;
              const texto = decodeURIComponent(b.dataset.txt);

              $('editPostId').value = id;
              $('editPostText').value = texto;
              
              $('editPostModal').style.display = 'flex';
          }
      });
  }

  $('btnCancelEdit').onclick = () => $('editPostModal').style.display = 'none';

  $('btnSaveEdit').onclick = () => {
      const id = $('editPostId').value;
      const novoTexto = $('editPostText').value;
      
      update(ref(db, 'posts/'+id), { texto: novoTexto }).then(() => {
          $('editPostModal').style.display = 'none';
      });
  };

  // --- CHAT PRIVADO PROFISSIONAL ---
  function loadChatList() {
      get(ref(db, 'membros')).then(snapshot => {
          if(snapshot.exists()) {
              allMembers = Object.entries(snapshot.val()).map(([id, user]) => ({...user, id})).filter(m => m.id !== userSession.id && m.status === 'Aprovado');
              renderChatList(allMembers);
          }
      });
  }

  function renderChatList(members) {
      const chatList = $('chatList');
      chatList.innerHTML = "";
      members.forEach(member => {
          const item = document.createElement('div');
          item.className = 'chat-item';
          item.innerHTML = `
              <img src="${member.foto || 'https://via.placeholder.com/40'}" class="chat-item-avatar">
              <div class="chat-item-info">
                  <div class="chat-item-name">${member.nome}</div>
                  <div class="chat-item-preview">${member.especialidades ? member.especialidades[0] : 'Psic√≥logo'}</div>
              </div>
          `;
          item.onclick = () => openChat(member.id, member.nome, member.foto);
          chatList.appendChild(item);
      });
  }

  $('chatSearch').addEventListener('keyup', (e) => {
      const search = e.target.value.toLowerCase();
      const filtered = allMembers.filter(m => m.nome.toLowerCase().includes(search));
      renderChatList(filtered);
  });

  function openChat(userId, userName, userFoto) {
      currentChatUser = { id: userId, nome: userName, foto: userFoto };
      $('chatHeaderNameText').textContent = userName;
      $('chatHeaderAvatar').src = userFoto || 'https://via.placeholder.com/32';
      $('chatMessagesArea').style.display = 'flex';
      loadChatMessages(userId);
      
      document.querySelectorAll('.chat-item').forEach(item => item.classList.remove('active'));
      event.target.closest('.chat-item').classList.add('active');
  }

  function loadChatMessages(userId) {
      const chatBody = $('chatBody');
      const chatKey = [userSession.id, userId].sort().join('_');
      
      onValue(ref(db, `chats/${chatKey}`), (snapshot) => {
          chatBody.innerHTML = "";
          if(snapshot.exists()) {
              Object.entries(snapshot.val()).forEach(([k, msg]) => {
                  const isOwn = msg.from === userSession.id;
                  const msgDiv = document.createElement('div');
                  msgDiv.className = `chat-message ${isOwn ? 'own' : 'other'}`;
                  
                  let content = decryptMessage(msg.texto);
                  
                  if(msg.midia) {
                      if(msg.tipo === 'image') {
                          content += `<br><img src="${msg.midia}" class="chat-media-preview">`;
                      } else if(msg.tipo === 'video') {
                          content += `<br><video src="${msg.midia}" class="chat-media-preview" controls></video>`;
                      } else if(msg.tipo === 'audio') {
                          content += `<br><audio src="${msg.midia}" class="chat-media-preview" controls></audio>`;
                      }
                  }
                  
                  msgDiv.innerHTML = content + `<div class="chat-message-time">${msg.hora}</div>`;
                  chatBody.appendChild(msgDiv);
              });
              chatBody.scrollTop = chatBody.scrollHeight;
          }
      });
  }

  $('btnSendChat').onclick = () => {
      if(!currentChatUser) return alert("Selecione um contato");
      const texto = $('chatInput').value.trim();
      if(!texto && !chatMediaBase64) return alert("Digite uma mensagem");
      
      const chatKey = [userSession.id, currentChatUser.id].sort().join('_');
      const msgData = {
          from: userSession.id,
          texto: encryptMessage(texto),
          hora: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
      };
      
      if(chatMediaBase64) {
          msgData.midia = chatMediaBase64;
          msgData.tipo = chatMediaType;
      }
      
      push(ref(db, `chats/${chatKey}`), msgData).then(() => {
          $('chatInput').value = "";
          chatMediaBase64 = "";
          chatMediaType = "";
          $('chatMediaFile').value = "";
      });
  };

  // --- PSI-POP CINEMA ---
  $('btnNovoVideo').onclick = () => $('formVideo').classList.remove('hidden');
  $('btnSalvarVideo').onclick = () => {
      push(ref(db, 'videos'), { 
          titulo: $('videoTitulo').value, 
          desc: $('videoDesc').value, 
          duracao: $('videoDuracao').value,
          url: $('videoUrl').value, 
          thumbnail: $('videoThumbnail').value,
          adicionadoPor: userSession.nome,
          data: new Date().toLocaleString('pt-BR')
      });
      $('formVideo').classList.add('hidden');
      $('videoTitulo').value = '';
      $('videoDesc').value = '';
      $('videoDuracao').value = '';
      $('videoUrl').value = '';
      $('videoThumbnail').value = '';
  };

  onValue(ref(db, 'videos'), s => {
      $('videoContainer').innerHTML = Object.entries(s.val()||{}).map(([k,v]) => `
          <div class="video-card">
              <div class="video-thumbnail" style="background-image: url('${v.thumbnail}'); background-size: cover; background-position: center;">
                  <span style="font-size: 2rem; text-shadow: 0 0 10px rgba(0,0,0,0.5);">‚ñ∂Ô∏è</span>
              </div>
              <div class="video-info">
                  <div class="video-title">${v.titulo}</div>
                  <div class="video-duration">‚è±Ô∏è ${v.duracao} min</div>
                  <div class="video-actions">
                      <a href="${v.url}" target="_blank" class="btn btn-primary" style="padding:8px;">Assistir</a>
                  </div>
              </div>
          </div>
      `).join('') || "<p>Nenhum v√≠deo dispon√≠vel.</p>";
  });

  // --- PAINEL DO GESTOR - NOVA INTERFACE FUNCIONAL ---
  
  // Tabs do painel
  document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.onclick = () => {
          document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
          tab.classList.add('active');
          $('tab-' + tab.dataset.tab).classList.add('active');
      };
  });

  // Carregar membros no painel
  onValue(ref(db, 'membros'), (snapshot) => {
      const lista = Object.entries(snapshot.val() || {}).map(([k, v]) => ({ ...v, id: k })).reverse();
      
      // Membros aprovados
      const aprovados = lista.filter(m => m.status === 'Aprovado');
      const pendentes = lista.filter(m => m.status === 'Pendente');
      
      renderMembrosAprovados(aprovados);
      renderMembrosPendentes(pendentes);
      renderSocialMembers(lista);
      loadChatList();
  });

  function renderMembrosAprovados(membros) {
      const container = $('membrosAprovados');
      container.innerHTML = "";
      
      if(membros.length === 0) {
          container.innerHTML = "<p style='color:#999; text-align:center;'>Nenhum membro aprovado.</p>";
          return;
      }
      
      membros.forEach(m => {
          const cargoClass = m.cargo === 'Fundador' ? 'badge-founder' : m.cargo === 'Admin' ? 'badge-adm' : 'badge-super';
          const card = document.createElement('div');
          card.className = 'member-card';
          card.innerHTML = `
              <div class="member-card-info">
                  <div class="member-card-name">${m.nome}</div>
                  <div class="member-card-details">CRP: ${m.crp} | ${m.email}</div>
                  <div class="member-card-badges">
                      <span class="badge badge-aprovado">Aprovado</span>
                      <span class="badge ${cargoClass}">${m.cargo}</span>
                  </div>
              </div>
              <div class="member-card-actions">
                  <button class="btn-edit" onclick="openEditMember('${m.id}', '${m.nome}', '${m.email}', '${m.whatsapp}')">‚úé Editar</button>
                  <button class="btn-role" onclick="openChangeRole('${m.id}', '${m.nome}')">üë§ Cargo</button>
                  <button class="btn-reset" onclick="openResetPassword('${m.id}', '${m.nome}')">üîë Senha</button>
                  <button class="btn-delete" onclick="deleteMember('${m.id}')">üóëÔ∏è Excluir</button>
              </div>
          `;
          container.appendChild(card);
      });
  }

  function renderMembrosPendentes(membros) {
      const container = $('membrosPendentes');
      container.innerHTML = "";
      
      if(membros.length === 0) {
          container.innerHTML = "<p style='color:#999; text-align:center;'>Nenhum membro pendente.</p>";
          return;
      }
      
      membros.forEach(m => {
          const card = document.createElement('div');
          card.className = 'member-card';
          card.innerHTML = `
              <div class="member-card-info">
                  <div class="member-card-name">${m.nome}</div>
                  <div class="member-card-details">CRP: ${m.crp} | ${m.email}</div>
                  <div class="member-card-badges">
                      <span class="badge badge-pendente">Pendente</span>
                  </div>
              </div>
              <div class="member-card-actions">
                  <button class="btn-edit" style="background:var(--success);" onclick="approveMember('${m.id}', '${m.whatsapp}')">‚úì Aprovar</button>
                  <button class="btn-delete" onclick="rejectMember('${m.id}')">‚úó Rejeitar</button>
              </div>
          `;
          container.appendChild(card);
      });
  }

  // Fun√ß√µes globais para os bot√µes
  window.openEditMember = (id, nome, email, whatsapp) => {
      $('editMemberId').value = id;
      $('editMemberName').value = nome;
      $('editMemberEmail').value = email;
      $('editMemberWhatsapp').value = whatsapp;
      $('editMemberModal').style.display = 'flex';
  };

  window.openChangeRole = (id, nome) => {
      $('changeRoleMemberId').value = id;
      $('changeRoleMemberName').value = nome;
      $('changeRoleModal').style.display = 'flex';
  };

  window.openResetPassword = (id, nome) => {
      $('resetPasswordMemberId').value = id;
      $('resetPasswordMemberName').value = nome;
      $('resetPasswordNew').value = '';
      $('resetPasswordModal').style.display = 'flex';
  };

  window.deleteMember = (id) => {
      if(confirm("Excluir este membro definitivamente?")) {
          remove(ref(db, 'membros/' + id));
      }
  };

  window.approveMember = (id, whatsapp) => {
      update(ref(db, 'membros/' + id), { status: 'Aprovado' });
      const url = `https://wa.me/55${whatsapp.replace(/\D/g,'')}?text=${encodeURIComponent("Ol√°! Sua inscri√ß√£o na UniPsi foi aprovada.")}`;
      window.open(url, '_blank');
  };

  window.rejectMember = (id) => {
      if(confirm("Rejeitar este membro?")) {
          update(ref(db, 'membros/' + id), { status: 'Rejeitado' });
      }
  };

  // Staff
  onValue(ref(db, 'staff'), s => {
      const container = $('candidatosStaff');
      const staff = Object.entries(s.val()||{});
      
      if(staff.length === 0) {
          container.innerHTML = "<p style='color:#999; text-align:center;'>Nenhum candidato.</p>";
          return;
      }
      
      container.innerHTML = staff.map(([k,v]) => `
          <div class="member-card">
              <div class="member-card-info">
                  <div class="member-card-name">${v.nome}</div>
                  <div class="member-card-details">WhatsApp: ${v.whatsapp}</div>
                  <div class="member-card-details" style="margin-top:5px;">${v.motivo}</div>
              </div>
              <div class="member-card-actions">
                  <button class="btn-delete" onclick="if(confirm('Remover candidatura?')) { remove(ref(db, 'staff/${k}')); }">Remover</button>
              </div>
          </div>
      `).join('');
  });

  function renderSocialMembers(lista) {
      const grid = $('containerMembros');
      grid.innerHTML = "";
      lista.filter(m => m.status === 'Aprovado').forEach(p => {
          const cargoClass = p.cargo === 'Fundador' ? 'badge-founder' : p.cargo === 'Admin' ? 'badge-adm' : p.cargo === 'Supervisor' ? 'badge-super' : 'badge-aprovado';
          grid.innerHTML += `<div class="product-card" style="padding:15px; text-align:center;">
             <img src="${p.foto || 'https://via.placeholder.com/80'}" style="width:70px; height:70px; border-radius:50%; object-fit:cover; margin:0 auto 10px;">
             <div style="font-weight:bold; color:var(--primary-color)">${p.nome}</div>
             <span class="badge ${cargoClass}" style="margin: 5px 0; display:inline-block;">${p.cargo || 'Membro'}</span>
             <div style="font-size:0.8rem; color:#666; margin:5px 0;">${p.abordagem || 'N√£o informada'}</div>
             <div style="font-size:0.75rem; margin-bottom:10px; color:#888;">${p.especialidades ? p.especialidades.slice(0,2).join(', ') : 'Psicologia'}</div>
             <a href="https://wa.me/55${p.whatsapp.replace(/\D/g,'')}" target="_blank" class="btn btn-secondary" style="padding:5px; font-size:0.8rem;">Conversar</a>
          </div>`;
      });
  }

  // Modal Editar Membro
  $('btnCancelEditMember').onclick = () => $('editMemberModal').style.display = 'none';
  $('btnConfirmEditMember').onclick = () => {
      const memberId = $('editMemberId').value;
      const updates = {
          email: $('editMemberEmail').value,
          whatsapp: $('editMemberWhatsapp').value
      };
      update(ref(db, `membros/${memberId}`), updates).then(() => {
          alert("Membro atualizado!");
          $('editMemberModal').style.display = 'none';
      });
  };

  // Modal Mudar Cargo
  $('btnCancelChangeRole').onclick = () => $('changeRoleModal').style.display = 'none';
  $('btnConfirmChangeRole').onclick = () => {
      const memberId = $('changeRoleMemberId').value;
      const novoCargo = $('changeRoleSelect').value;
      if(!novoCargo) return alert("Selecione um cargo!");
      update(ref(db, `membros/${memberId}`), { cargo: novoCargo }).then(() => {
          alert("Cargo atualizado!");
          $('changeRoleModal').style.display = 'none';
      });
  };

  // Modal Reset Senha
  $('btnCancelResetPassword').onclick = () => $('resetPasswordModal').style.display = 'none';
  $('btnConfirmResetPassword').onclick = () => {
      const memberId = $('resetPasswordMemberId').value;
      const novaSenha = $('resetPasswordNew').value.trim();
      if(!novaSenha) return alert("Digite uma nova senha!");
      update(ref(db, `membros/${memberId}`), { senha: novaSenha }).then(() => {
          alert("Senha resetada com sucesso!");
          $('resetPasswordModal').style.display = 'none';
      });
  };

  // --- AUTENTICA√á√ÉO DO PAINEL DO GESTOR COM MANTER CONECTADO ---
  $('btnAcessarAdmin').onclick = () => {
      const senha = $('adminPassword').value;
      const rememberAdmin = $('rememberAdmin').checked;
      
      if(ADMIN_PASSWORDS[senha]) {
          adminAuthenticated = true;
          adminLevel = ADMIN_PASSWORDS[senha];
          $('adminAuthContainer').style.display = 'none';
          $('adminDashboard').style.display = 'block';
          $('adminPassword').value = "";
          $('nivelAcesso').textContent = adminLevel;
          $('nivelAcesso').className = 'badge ' + (adminLevel === 'Fundador' ? 'badge-founder' : adminLevel === 'Admin' ? 'badge-adm' : 'badge-super');
          
          if(rememberAdmin) {
              localStorage.setItem('adminAuthenticated', 'true');
              localStorage.setItem('adminLevel', adminLevel);
          }
      } else {
          $('adminAuthError').textContent = "Senha incorreta!";
          $('adminAuthError').style.display = 'block';
      }
  };



  // --- LOJA E STAFF ---
  $('btnNovoProduto').onclick = () => $('formProduto').classList.remove('hidden');
  $('btnSalvarProduto').onclick = () => {
      push(ref(db, 'produtos'), { titulo: $('prodTitulo').value, desc: $('prodDesc').value, valor: $('prodValor').value, link: $('prodLink').value, img: $('prodImg').value });
      $('formProduto').classList.add('hidden');
  };
  onValue(ref(db, 'produtos'), s => {
      $('lojaContainer').innerHTML = Object.entries(s.val()||{}).map(([k,v]) => `<div class="product-card"><img src="${v.img}" class="product-img"><div class="product-body"><div class="product-title">${v.titulo}</div><div class="product-price">${v.valor}</div><a href="${v.link}" target="_blank" class="btn btn-primary">Acessar</a></div></div>`).join('') || "Vazio.";
  });
  $('staffForm').onsubmit = (e) => { e.preventDefault(); push(ref(db, 'staff'), { nome: $('staffNome').value, whatsapp: $('staffWhats').value, motivo: $('staffMotivo').value }).then(()=>alert("Enviado!")); };

  $('buscaMembro').onkeyup = () => {
      const t = $('buscaMembro').value.toLowerCase();
      for(let c of $('containerMembros').children) c.style.display = c.innerText.toLowerCase().includes(t) ? "block" : "none";
  };

  // --- REUNI√ïES COM JITSI MEET ---
  $('btnEntrarReuniao').onclick = () => {
      const roomId = $('jitsiRoomId').value.trim();
      if(!roomId) return alert("Digite um ID de sala v√°lido!");
      
      const domain = "meet.jit.si";
      const options = {
          roomName: roomId,
          width: "100%",
          height: 600,
          parentNode: document.querySelector('#jitsiContainer'),
          userInfo: {
              displayName: userSession ? userSession.nome : "Visitante"
          }
      };
      
      const script = document.createElement('script');
      script.src = 'https://meet.jit.si/external_api.js';
      document.head.appendChild(script);
      
      script.onload = () => {
          new window.JitsiMeetExternalAPI(domain, options);
      };
  };

  
  // --- EXCLUIR PR√ìPRIA CONTA ---
  if($('btnExcluirMinhaConta')) {
      $('btnExcluirMinhaConta').onclick = () => {
          if(!userSession) return;
          if(confirm("ATEN√á√ÉO: Voc√™ est√° prestes a excluir sua conta permanentemente. Esta a√ß√£o n√£o pode ser desfeita. Deseja continuar?")) {
              if(confirm("Tem certeza absoluta? Todos os seus dados ser√£o perdidos.")) {
                  remove(ref(db, `membros/${userSession.id}`)).then(() => {
                      alert("Sua conta foi exclu√≠da com sucesso. Voc√™ ser√° desconectado.");
                      userSession = null;
                      adminAuthenticated = false;
                      localStorage.removeItem('userSession');
                      localStorage.removeItem('rememberLogin');
                      localStorage.removeItem('adminAuthenticated');
                      localStorage.removeItem('adminLevel');
                      location.reload();
                  });
              }
          }
      };
  }

  // --- NAVEGA√á√ÉO PRINCIPAL ---
  $('btn-social').onclick = () => { showView('socialView'); setActiveNav('btn-social'); };
  $('btn-perfil').onclick = () => { showView('profileView'); setActiveNav('btn-perfil'); populateProfile(); };
  $('btn-chat').onclick = () => { showView('chatView'); setActiveNav('btn-chat'); loadChatList(); };
  $('btn-recursos').onclick = () => { 
      showView('recursosView'); 
      setActiveNav('btn-recursos');
      if(userSession && (userSession.cargo === 'Supervisor' || userSession.cargo === 'Fundador')) {
          $('btnNovoProduto').classList.remove('hidden');
      } else {
          $('btnNovoProduto').classList.add('hidden');
      }
  };
  $('btn-psipop').onclick = () => { 
      showView('psiPopView'); 
      setActiveNav('btn-psipop');
      if(userSession && (userSession.cargo === 'Supervisor' || userSession.cargo === 'Fundador')) {
          $('btnNovoVideo').classList.remove('hidden');
      } else {
          $('btnNovoVideo').classList.add('hidden');
      }
  };
  $('btn-reunioes').onclick = () => { showView('reunioesView'); setActiveNav('btn-reunioes'); };
  $('btn-staff').onclick = () => { showView('staffRequestView'); setActiveNav('btn-staff'); };
  $('btn-admin').onclick = () => { 
      // Verificar se j√° est√° autenticado no painel
      const savedAdminAuth = localStorage.getItem('adminAuthenticated');
      const savedAdminLevel = localStorage.getItem('adminLevel');
      
      if(savedAdminAuth === 'true' && savedAdminLevel) {
          adminAuthenticated = true;
          adminLevel = savedAdminLevel;
          $('adminAuthContainer').style.display = 'none';
          $('adminDashboard').style.display = 'block';
          $('nivelAcesso').textContent = adminLevel;
          $('nivelAcesso').className = 'badge ' + (adminLevel === 'Fundador' ? 'badge-founder' : adminLevel === 'Admin' ? 'badge-adm' : 'badge-super');
      } else {
          adminAuthenticated = false;
          $('adminAuthContainer').style.display = 'block';
          $('adminDashboard').style.display = 'none';
          $('adminPassword').value = "";
          $('adminAuthError').style.display = 'none';
      }
      
      showView('adminView'); 
      setActiveNav('btn-admin'); 
      
  };
  $('btn-sair').onclick = () => {
      userSession = null;
      adminAuthenticated = false;
      adminLevel = null;
      localStorage.removeItem('userSession');
      localStorage.removeItem('rememberLogin');
      localStorage.removeItem('adminAuthenticated');
      localStorage.removeItem('adminLevel');
      document.getElementById('mainNav').classList.remove('auth-hidden');
      document.getElementById('mainNav').classList.add('auth-hidden');
      showView('loginView');
      setActiveNav('btn-social');
      
  };

  // --- RESTAURAR SESS√ÉO COM MANTER CONECTADO ---
  const saved = localStorage.getItem('userSession');
  const rememberLogin = localStorage.getItem('rememberLogin');
  
  if(saved && rememberLogin === 'true') {
      userSession = JSON.parse(saved);
      document.getElementById('mainNav').classList.remove('auth-hidden');
      showView('socialView');
      populateProfile();
      $('userAvatarPost').src = userSession.foto || 'https://via.placeholder.com/40';
      if(userSession.cargo === 'Admin' || userSession.cargo === 'Supervisor' || userSession.cargo === 'Fundador') {
          $('btn-admin').style.display = 'block';
      } else {
          $('btn-admin').style.display = 'none';
      }
  } else if(saved) {
      userSession = JSON.parse(saved);
      document.getElementById('mainNav').classList.remove('auth-hidden');
      showView('socialView');
      populateProfile();
      $('userAvatarPost').src = userSession.foto || 'https://via.placeholder.com/40';
      if(userSession.cargo === 'Admin' || userSession.cargo === 'Supervisor' || userSession.cargo === 'Fundador') {
          $('btn-admin').style.display = 'block';
      } else {
          $('btn-admin').style.display = 'none';
      }
  }
</script>
</body>
</html>
